<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Example: Cloud-distributed k-means clustering with incremental notifications
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An open source framework for large-scale distributed computation and data processing written in F#."/>
    <meta name="author" content="Jan Dzik, Nick Palladinos, Kostas Rontogiannis, Eirik Tsarpalis"/>
    
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-196x196.png" sizes="196x196"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-160x160.png" sizes="160x160"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-96x96.png" sizes="96x96"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-16x16.png" sizes="16x16"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-32x32.png" sizes="32x32"/>

    <link type="text/css" rel="stylesheet" href="http://www.m-brace.net/content/style.css" />
    <script type="text/javascript" src="http://www.m-brace.net/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://github.com/mbraceproject/MBrace.Core">github page</a></li>
        </ul>
        <h3 class="muted"><a href="http://www.m-brace.net/index.html">MBrace.Core and MBrace.Azure</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Example-Cloud-distributed-k-means-clustering-with-incremental-notifications" class="anchor" href="#Example-Cloud-distributed-k-means-clustering-with-incremental-notifications">Example: Cloud-distributed k-means clustering with incremental notifications</a></h1>

<blockquote>
  <p>This example is from the <a href="https://github.com/mbraceproject/MBrace.StarterKit">MBrace Starter Kit</a>.</p>
</blockquote>

<p>This example shows how to implement the iterative algorithm k-Means, which finds centroids of clusters for points.</p>

<p>It shows some important techniques</p>

<ul>
<li><p>How to partition data and keep affinity of workers to data</p></li>
<li><p>How to emit partial results to an intermediate queue</p></li>
<li><p>How to observe that queue using incremental charting</p></li>
</ul>

<p>First define some parameters for the input set we want to classify:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 11)" onmouseover="showTip(event, 'fs11', 11)" class="i">dim</span> <span class="o">=</span> <span class="n">2</span> <span class="c">// point dimensions: we use 2 dimensions so we can chart the results</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 12)" onmouseover="showTip(event, 'fs12', 12)" class="i">numCentroids</span> <span class="o">=</span> <span class="n">5</span> <span class="c">// The number of centroids to find</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 13)" onmouseover="showTip(event, 'fs13', 13)" class="i">partitions</span> <span class="o">=</span> <span class="n">12</span> <span class="c">// The number of point partitions</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 14)" onmouseover="showTip(event, 'fs14', 14)" class="i">pointsPerPartition</span> <span class="o">=</span> <span class="n">50000</span> <span class="c">// The number of points per partition</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 15)" onmouseover="showTip(event, 'fs15', 15)" class="i">epsilon</span> <span class="o">=</span> <span class="n">0.1</span>
</code></pre></td>
</tr>
</table>

<p>Generate some random input data, a deterministic set of points based on the parameters above.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Represents a multi-dimensional point.</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs16', 16)" onmouseover="showTip(event, 'fs16', 16)" class="t">Point</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 17)" onmouseover="showTip(event, 'fs17', 17)" class="t">float</span>[]

<span class="c">/// Generates a set of points via a random walk from the origin, using provided seed.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 18)" onmouseover="showTip(event, 'fs18', 18)" class="f">generatePoints</span> <span onmouseout="hideTip(event, 'fs19', 19)" onmouseover="showTip(event, 'fs19', 19)" class="i">dim</span> <span onmouseout="hideTip(event, 'fs20', 20)" onmouseover="showTip(event, 'fs20', 20)" class="i">numPoints</span> <span onmouseout="hideTip(event, 'fs21', 21)" onmouseover="showTip(event, 'fs21', 21)" class="i">seed</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="t">Point</span>[] <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 23)" onmouseover="showTip(event, 'fs22', 23)" class="i">rand</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 24)" onmouseover="showTip(event, 'fs23', 24)" class="t">Random</span>(<span onmouseout="hideTip(event, 'fs21', 25)" onmouseover="showTip(event, 'fs21', 25)" class="i">seed</span> <span class="o">*</span> <span class="n">2003</span> <span class="o">+</span> <span class="n">22</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 26)" onmouseover="showTip(event, 'fs24', 26)" class="i">prev</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 27)" onmouseover="showTip(event, 'fs25', 27)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 28)" onmouseover="showTip(event, 'fs26', 28)" class="f">zeroCreate</span> <span onmouseout="hideTip(event, 'fs19', 29)" onmouseover="showTip(event, 'fs19', 29)" class="i">dim</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 30)" onmouseover="showTip(event, 'fs27', 30)" class="f">nextPoint</span> () <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 31)" onmouseover="showTip(event, 'fs28', 31)" class="i">arr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 32)" onmouseover="showTip(event, 'fs25', 32)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 33)" onmouseover="showTip(event, 'fs26', 33)" class="f">zeroCreate</span> <span onmouseout="hideTip(event, 'fs19', 34)" onmouseover="showTip(event, 'fs19', 34)" class="i">dim</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 35)" onmouseover="showTip(event, 'fs29', 35)" class="i">i</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="i">dim</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span> 
            <span onmouseout="hideTip(event, 'fs28', 37)" onmouseover="showTip(event, 'fs28', 37)" class="i">arr</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 38)" onmouseover="showTip(event, 'fs29', 38)" class="i">i</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs24', 39)" onmouseover="showTip(event, 'fs24', 39)" class="i">prev</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 40)" onmouseover="showTip(event, 'fs29', 40)" class="i">i</span>] <span class="o">+</span> <span onmouseout="hideTip(event, 'fs22', 41)" onmouseover="showTip(event, 'fs22', 41)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 42)" onmouseover="showTip(event, 'fs30', 42)" class="f">NextDouble</span>() <span class="o">*</span> <span class="n">40.0</span> <span class="o">-</span> <span class="n">20.0</span>
            <span onmouseout="hideTip(event, 'fs24', 43)" onmouseover="showTip(event, 'fs24', 43)" class="i">prev</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 44)" onmouseover="showTip(event, 'fs29', 44)" class="i">i</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs28', 45)" onmouseover="showTip(event, 'fs28', 45)" class="i">arr</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 46)" onmouseover="showTip(event, 'fs29', 46)" class="i">i</span>]
        <span onmouseout="hideTip(event, 'fs28', 47)" onmouseover="showTip(event, 'fs28', 47)" class="i">arr</span>

    [| <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 48)" onmouseover="showTip(event, 'fs29', 48)" class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span onmouseout="hideTip(event, 'fs20', 49)" onmouseover="showTip(event, 'fs20', 49)" class="i">numPoints</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs27', 50)" onmouseover="showTip(event, 'fs27', 50)" class="f">nextPoint</span>() |]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 51)" onmouseover="showTip(event, 'fs31', 51)" class="i">randPoints</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 52)" onmouseover="showTip(event, 'fs25', 52)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 53)" onmouseover="showTip(event, 'fs32', 53)" class="f">init</span> <span onmouseout="hideTip(event, 'fs13', 54)" onmouseover="showTip(event, 'fs13', 54)" class="i">partitions</span> (<span onmouseout="hideTip(event, 'fs18', 55)" onmouseover="showTip(event, 'fs18', 55)" class="f">generatePoints</span> <span onmouseout="hideTip(event, 'fs11', 56)" onmouseover="showTip(event, 'fs11', 56)" class="i">dim</span> <span onmouseout="hideTip(event, 'fs14', 57)" onmouseover="showTip(event, 'fs14', 57)" class="i">pointsPerPartition</span>)
</code></pre></td>
</tr>
</table>

<p>Next you display a chart showing the first 500 points from each partition:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 58)" onmouseover="showTip(event, 'fs33', 58)" class="f">point2d</span> (<span onmouseout="hideTip(event, 'fs34', 59)" onmouseover="showTip(event, 'fs34', 59)" class="i">p</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 60)" onmouseover="showTip(event, 'fs16', 60)" class="t">Point</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 61)" onmouseover="showTip(event, 'fs34', 61)" class="i">p</span><span class="o">.</span>[<span class="n">0</span>], <span onmouseout="hideTip(event, 'fs34', 62)" onmouseover="showTip(event, 'fs34', 62)" class="i">p</span><span class="o">.</span>[<span class="n">1</span>]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 63)" onmouseover="showTip(event, 'fs35', 63)" class="i">selectionOfPoints</span> <span class="o">=</span> 
    [ <span class="k">for</span> <span onmouseout="hideTip(event, 'fs36', 64)" onmouseover="showTip(event, 'fs36', 64)" class="i">points</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs31', 65)" onmouseover="showTip(event, 'fs31', 65)" class="i">randPoints</span> <span class="k">do</span> 
         <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 66)" onmouseover="showTip(event, 'fs29', 66)" class="i">i</span> <span class="k">in</span> <span class="n">0</span> <span class="o">..</span> <span class="n">100</span> <span class="o">..</span> <span onmouseout="hideTip(event, 'fs36', 67)" onmouseover="showTip(event, 'fs36', 67)" class="i">points</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 68)" onmouseover="showTip(event, 'fs37', 68)" class="i">Length</span><span class="o">-</span><span class="n">1</span> <span class="k">do</span>
             <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs33', 69)" onmouseover="showTip(event, 'fs33', 69)" class="f">point2d</span> <span onmouseout="hideTip(event, 'fs36', 70)" onmouseover="showTip(event, 'fs36', 70)" class="i">points</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 71)" onmouseover="showTip(event, 'fs29', 71)" class="i">i</span>] ]

<span onmouseout="hideTip(event, 'fs38', 72)" onmouseover="showTip(event, 'fs38', 72)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 73)" onmouseover="showTip(event, 'fs39', 73)" class="f">Point</span> <span onmouseout="hideTip(event, 'fs35', 74)" onmouseover="showTip(event, 'fs35', 74)" class="i">selectionOfPoints</span> 
</code></pre></td>
</tr>
</table>

<p>Giving <img src="../img/kmeans-input.png" alt="Input to KMeans" /></p>

<p>Now you define a set of helper functions and types related to points and finding centroids:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span onmouseout="hideTip(event, 'fs40', 75)" onmouseover="showTip(event, 'fs40', 75)" class="t">AutoOpen</span>&gt;]
<span class="k">module</span> <span class="t">KMeansHelpers</span> <span class="o">=</span>

    <span class="c">/// Calculates the distance between two points.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs41', 76)" onmouseover="showTip(event, 'fs41', 76)" class="f">dist</span> (<span onmouseout="hideTip(event, 'fs42', 77)" onmouseover="showTip(event, 'fs42', 77)" class="i">p1</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 78)" onmouseover="showTip(event, 'fs16', 78)" class="t">Point</span>) (<span onmouseout="hideTip(event, 'fs43', 79)" onmouseover="showTip(event, 'fs43', 79)" class="i">p2</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 80)" onmouseover="showTip(event, 'fs16', 80)" class="t">Point</span>) <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs25', 81)" onmouseover="showTip(event, 'fs25', 81)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 82)" onmouseover="showTip(event, 'fs44', 82)" class="f">fold2</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs45', 83)" onmouseover="showTip(event, 'fs45', 83)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs46', 84)" onmouseover="showTip(event, 'fs46', 84)" class="i">e1</span> <span onmouseout="hideTip(event, 'fs47', 85)" onmouseover="showTip(event, 'fs47', 85)" class="i">e2</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs45', 86)" onmouseover="showTip(event, 'fs45', 86)" class="i">acc</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs48', 87)" onmouseover="showTip(event, 'fs48', 87)" class="f">pown</span> (<span onmouseout="hideTip(event, 'fs46', 88)" onmouseover="showTip(event, 'fs46', 88)" class="i">e1</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs47', 89)" onmouseover="showTip(event, 'fs47', 89)" class="i">e2</span>) <span class="n">2</span>) <span class="n">0.0</span> <span onmouseout="hideTip(event, 'fs42', 90)" onmouseover="showTip(event, 'fs42', 90)" class="i">p1</span> <span onmouseout="hideTip(event, 'fs43', 91)" onmouseover="showTip(event, 'fs43', 91)" class="i">p2</span>

    <span class="c">/// Assigns a point to the correct centroid, and returns the index of that centroid.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 92)" onmouseover="showTip(event, 'fs49', 92)" class="f">findCentroid</span> (<span onmouseout="hideTip(event, 'fs34', 93)" onmouseover="showTip(event, 'fs34', 93)" class="i">p</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 94)" onmouseover="showTip(event, 'fs16', 94)" class="t">Point</span>) (<span onmouseout="hideTip(event, 'fs50', 95)" onmouseover="showTip(event, 'fs50', 95)" class="i">centroids</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 96)" onmouseover="showTip(event, 'fs16', 96)" class="t">Point</span>[]) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs51', 97)" onmouseover="showTip(event, 'fs51', 97)" class="t">int</span> <span class="o">=</span>
        <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs52', 98)" onmouseover="showTip(event, 'fs52', 98)" class="v">mini</span> <span class="o">=</span> <span class="n">0</span>
        <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs53', 99)" onmouseover="showTip(event, 'fs53', 99)" class="v">min</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs54', 100)" onmouseover="showTip(event, 'fs54', 100)" class="t">Double</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs55', 101)" onmouseover="showTip(event, 'fs55', 101)" class="i">PositiveInfinity</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 102)" onmouseover="showTip(event, 'fs29', 102)" class="i">i</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs50', 103)" onmouseover="showTip(event, 'fs50', 103)" class="i">centroids</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 104)" onmouseover="showTip(event, 'fs37', 104)" class="i">Length</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs56', 105)" onmouseover="showTip(event, 'fs56', 105)" class="i">dist</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs56', 106)" onmouseover="showTip(event, 'fs56', 106)" class="f">dist</span> <span onmouseout="hideTip(event, 'fs34', 107)" onmouseover="showTip(event, 'fs34', 107)" class="i">p</span> <span onmouseout="hideTip(event, 'fs50', 108)" onmouseover="showTip(event, 'fs50', 108)" class="i">centroids</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 109)" onmouseover="showTip(event, 'fs29', 109)" class="i">i</span>]
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs56', 110)" onmouseover="showTip(event, 'fs56', 110)" class="i">dist</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs53', 111)" onmouseover="showTip(event, 'fs53', 111)" class="v">min</span> <span class="k">then</span>
                <span onmouseout="hideTip(event, 'fs53', 112)" onmouseover="showTip(event, 'fs53', 112)" class="v">min</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs56', 113)" onmouseover="showTip(event, 'fs56', 113)" class="i">dist</span>
                <span onmouseout="hideTip(event, 'fs52', 114)" onmouseover="showTip(event, 'fs52', 114)" class="v">mini</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs29', 115)" onmouseover="showTip(event, 'fs29', 115)" class="i">i</span>

        <span onmouseout="hideTip(event, 'fs52', 116)" onmouseover="showTip(event, 'fs52', 116)" class="v">mini</span>

    <span class="c">/// Given a set of points, calculates the number of points assigned to each centroid.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 117)" onmouseover="showTip(event, 'fs57', 117)" class="f">kmeansLocal</span> (<span onmouseout="hideTip(event, 'fs36', 118)" onmouseover="showTip(event, 'fs36', 118)" class="i">points</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 119)" onmouseover="showTip(event, 'fs16', 119)" class="t">Point</span>[]) (<span onmouseout="hideTip(event, 'fs50', 120)" onmouseover="showTip(event, 'fs50', 120)" class="i">centroids</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 121)" onmouseover="showTip(event, 'fs16', 121)" class="t">Point</span>[]) <span class="o">:</span> (<span onmouseout="hideTip(event, 'fs51', 122)" onmouseover="showTip(event, 'fs51', 122)" class="t">int</span> <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs51', 123)" onmouseover="showTip(event, 'fs51', 123)" class="t">int</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs16', 124)" onmouseover="showTip(event, 'fs16', 124)" class="t">Point</span>))[] <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs58', 125)" onmouseover="showTip(event, 'fs58', 125)" class="i">lens</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 126)" onmouseover="showTip(event, 'fs25', 126)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 127)" onmouseover="showTip(event, 'fs26', 127)" class="f">zeroCreate</span> <span onmouseout="hideTip(event, 'fs50', 128)" onmouseover="showTip(event, 'fs50', 128)" class="i">centroids</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 129)" onmouseover="showTip(event, 'fs37', 129)" class="i">Length</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs59', 130)" onmouseover="showTip(event, 'fs59', 130)" class="i">sums</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs25', 131)" onmouseover="showTip(event, 'fs25', 131)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 132)" onmouseover="showTip(event, 'fs32', 132)" class="f">init</span> <span onmouseout="hideTip(event, 'fs50', 133)" onmouseover="showTip(event, 'fs50', 133)" class="i">centroids</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 134)" onmouseover="showTip(event, 'fs37', 134)" class="i">Length</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs25', 135)" onmouseover="showTip(event, 'fs25', 135)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 136)" onmouseover="showTip(event, 'fs26', 136)" class="f">zeroCreate</span> <span onmouseout="hideTip(event, 'fs50', 137)" onmouseover="showTip(event, 'fs50', 137)" class="i">centroids</span><span class="o">.</span>[<span class="n">0</span>]<span class="o">.</span><span class="i">Length</span>)

        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs60', 138)" onmouseover="showTip(event, 'fs60', 138)" class="i">point</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs36', 139)" onmouseover="showTip(event, 'fs36', 139)" class="i">points</span> <span class="k">do</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs61', 140)" onmouseover="showTip(event, 'fs61', 140)" class="i">cent</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs49', 141)" onmouseover="showTip(event, 'fs49', 141)" class="f">findCentroid</span> <span onmouseout="hideTip(event, 'fs60', 142)" onmouseover="showTip(event, 'fs60', 142)" class="i">point</span> <span onmouseout="hideTip(event, 'fs50', 143)" onmouseover="showTip(event, 'fs50', 143)" class="i">centroids</span>
            <span onmouseout="hideTip(event, 'fs58', 144)" onmouseover="showTip(event, 'fs58', 144)" class="i">lens</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs61', 145)" onmouseover="showTip(event, 'fs61', 145)" class="i">cent</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs58', 146)" onmouseover="showTip(event, 'fs58', 146)" class="i">lens</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs61', 147)" onmouseover="showTip(event, 'fs61', 147)" class="i">cent</span>] <span class="o">+</span> <span class="n">1</span>
            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 148)" onmouseover="showTip(event, 'fs29', 148)" class="i">i</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs60', 149)" onmouseover="showTip(event, 'fs60', 149)" class="i">point</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 150)" onmouseover="showTip(event, 'fs37', 150)" class="i">Length</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span>
                <span onmouseout="hideTip(event, 'fs59', 151)" onmouseover="showTip(event, 'fs59', 151)" class="i">sums</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs61', 152)" onmouseover="showTip(event, 'fs61', 152)" class="i">cent</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 153)" onmouseover="showTip(event, 'fs29', 153)" class="i">i</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs59', 154)" onmouseover="showTip(event, 'fs59', 154)" class="i">sums</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs61', 155)" onmouseover="showTip(event, 'fs61', 155)" class="i">cent</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 156)" onmouseover="showTip(event, 'fs29', 156)" class="i">i</span>] <span class="o">+</span> <span onmouseout="hideTip(event, 'fs60', 157)" onmouseover="showTip(event, 'fs60', 157)" class="i">point</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 158)" onmouseover="showTip(event, 'fs29', 158)" class="i">i</span>]

        <span onmouseout="hideTip(event, 'fs25', 159)" onmouseover="showTip(event, 'fs25', 159)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 160)" onmouseover="showTip(event, 'fs32', 160)" class="f">init</span> <span onmouseout="hideTip(event, 'fs50', 161)" onmouseover="showTip(event, 'fs50', 161)" class="i">centroids</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 162)" onmouseover="showTip(event, 'fs37', 162)" class="i">Length</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs29', 163)" onmouseover="showTip(event, 'fs29', 163)" class="i">i</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs29', 164)" onmouseover="showTip(event, 'fs29', 164)" class="i">i</span>, (<span onmouseout="hideTip(event, 'fs58', 165)" onmouseover="showTip(event, 'fs58', 165)" class="i">lens</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 166)" onmouseover="showTip(event, 'fs29', 166)" class="i">i</span>], <span onmouseout="hideTip(event, 'fs59', 167)" onmouseover="showTip(event, 'fs59', 167)" class="i">sums</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 168)" onmouseover="showTip(event, 'fs29', 168)" class="i">i</span>])))

    <span class="c">/// Sums a collection of points</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 169)" onmouseover="showTip(event, 'fs62', 169)" class="f">sumPoints</span> (<span onmouseout="hideTip(event, 'fs63', 170)" onmouseover="showTip(event, 'fs63', 170)" class="i">pointArr</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 171)" onmouseover="showTip(event, 'fs16', 171)" class="t">Point</span> []) <span onmouseout="hideTip(event, 'fs19', 172)" onmouseover="showTip(event, 'fs19', 172)" class="i">dim</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 173)" onmouseover="showTip(event, 'fs16', 173)" class="t">Point</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 174)" onmouseover="showTip(event, 'fs64', 174)" class="i">sum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 175)" onmouseover="showTip(event, 'fs25', 175)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 176)" onmouseover="showTip(event, 'fs26', 176)" class="f">zeroCreate</span> <span onmouseout="hideTip(event, 'fs19', 177)" onmouseover="showTip(event, 'fs19', 177)" class="i">dim</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs34', 178)" onmouseover="showTip(event, 'fs34', 178)" class="i">p</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs63', 179)" onmouseover="showTip(event, 'fs63', 179)" class="i">pointArr</span> <span class="k">do</span>
            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 180)" onmouseover="showTip(event, 'fs29', 180)" class="i">i</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs19', 181)" onmouseover="showTip(event, 'fs19', 181)" class="i">dim</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span>
                <span onmouseout="hideTip(event, 'fs64', 182)" onmouseover="showTip(event, 'fs64', 182)" class="i">sum</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 183)" onmouseover="showTip(event, 'fs29', 183)" class="i">i</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs64', 184)" onmouseover="showTip(event, 'fs64', 184)" class="i">sum</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 185)" onmouseover="showTip(event, 'fs29', 185)" class="i">i</span>] <span class="o">+</span> <span onmouseout="hideTip(event, 'fs34', 186)" onmouseover="showTip(event, 'fs34', 186)" class="i">p</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs29', 187)" onmouseover="showTip(event, 'fs29', 187)" class="i">i</span>]
        <span onmouseout="hideTip(event, 'fs64', 188)" onmouseover="showTip(event, 'fs64', 188)" class="i">sum</span>

    <span class="c">/// Scalar division of a point</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs65', 189)" onmouseover="showTip(event, 'fs65', 189)" class="f">divPoint</span> (<span onmouseout="hideTip(event, 'fs60', 190)" onmouseover="showTip(event, 'fs60', 190)" class="i">point</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 191)" onmouseover="showTip(event, 'fs16', 191)" class="t">Point</span>) (<span onmouseout="hideTip(event, 'fs66', 192)" onmouseover="showTip(event, 'fs66', 192)" class="i">x</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs17', 193)" onmouseover="showTip(event, 'fs17', 193)" class="t">float</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 194)" onmouseover="showTip(event, 'fs16', 194)" class="t">Point</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs25', 195)" onmouseover="showTip(event, 'fs25', 195)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 196)" onmouseover="showTip(event, 'fs67', 196)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs68', 197)" onmouseover="showTip(event, 'fs68', 197)" class="i">p</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs68', 198)" onmouseover="showTip(event, 'fs68', 198)" class="i">p</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs66', 199)" onmouseover="showTip(event, 'fs66', 199)" class="i">x</span>) <span onmouseout="hideTip(event, 'fs60', 200)" onmouseover="showTip(event, 'fs60', 200)" class="i">point</span>
</code></pre></td>
</tr>
</table>

<p>This is the iterative computation.  Computes the new centroids based on classifying each point to an existing centroid. 
Then computes new centroids based on that classification.  <code>emit</code> is used to emit observations of 
intermediate states to a queue or some other sink.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs69', 201)" onmouseover="showTip(event, 'fs69', 201)" class="f">KMeansCloudIterate</span> (<span onmouseout="hideTip(event, 'fs70', 202)" onmouseover="showTip(event, 'fs70', 202)" class="i">partitionedPoints</span>, <span onmouseout="hideTip(event, 'fs71', 203)" onmouseover="showTip(event, 'fs71', 203)" class="i">epsilon</span>, <span onmouseout="hideTip(event, 'fs72', 204)" onmouseover="showTip(event, 'fs72', 204)" class="i">centroids</span>, <span onmouseout="hideTip(event, 'fs73', 205)" onmouseover="showTip(event, 'fs73', 205)" class="i">iteration</span>, <span onmouseout="hideTip(event, 'fs74', 206)" onmouseover="showTip(event, 'fs74', 206)" class="i">emit</span>) <span class="o">=</span> <span class="i">cloud</span> {

     <span class="c">// Stage 1: map computations to each worker per point partition</span>
    <span class="k">let!</span> <span class="i">clusterParts</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs70', 207)" onmouseover="showTip(event, 'fs70', 207)" class="i">partitionedPoints</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 208)" onmouseover="showTip(event, 'fs25', 208)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 209)" onmouseover="showTip(event, 'fs67', 209)" class="i">map</span> (<span class="k">fun</span> (<span class="i">p</span><span class="o">:</span><span class="i">CloudArray</span><span class="o">&lt;</span>_<span class="o">&gt;</span>, <span class="i">w</span>) <span class="k">-&gt;</span> <span class="i">cloud</span> { <span class="k">return</span> <span onmouseout="hideTip(event, 'fs57', 210)" onmouseover="showTip(event, 'fs57', 210)" class="i">kmeansLocal</span> <span class="i">p</span><span class="o">.</span><span class="i">Value</span> <span onmouseout="hideTip(event, 'fs72', 211)" onmouseover="showTip(event, 'fs72', 211)" class="i">centroids</span> }, <span class="i">w</span>)
        <span class="o">|&gt;</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span>

    <span class="c">// Stage 2: reduce computations to obtain the new centroids</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 212)" onmouseover="showTip(event, 'fs11', 212)" class="i">dim</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs72', 213)" onmouseover="showTip(event, 'fs72', 213)" class="i">centroids</span><span class="o">.</span>[<span class="n">0</span>]<span class="o">.</span><span class="i">Length</span>
    <span class="k">let</span> <span class="i">newCentroids</span> <span class="o">=</span>
        <span class="i">clusterParts</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 214)" onmouseover="showTip(event, 'fs25', 214)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs75', 215)" onmouseover="showTip(event, 'fs75', 215)" class="i">concat</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 216)" onmouseover="showTip(event, 'fs76', 216)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 217)" onmouseover="showTip(event, 'fs77', 217)" class="i">ofArray</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 218)" onmouseover="showTip(event, 'fs76', 218)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs78', 219)" onmouseover="showTip(event, 'fs78', 219)" class="i">groupBy</span> <span onmouseout="hideTip(event, 'fs79', 220)" onmouseover="showTip(event, 'fs79', 220)" class="i">fst</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 221)" onmouseover="showTip(event, 'fs76', 221)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs80', 222)" onmouseover="showTip(event, 'fs80', 222)" class="i">sortBy</span> <span onmouseout="hideTip(event, 'fs79', 223)" onmouseover="showTip(event, 'fs79', 223)" class="i">fst</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 224)" onmouseover="showTip(event, 'fs76', 224)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 225)" onmouseover="showTip(event, 'fs81', 225)" class="i">map</span> <span onmouseout="hideTip(event, 'fs82', 226)" onmouseover="showTip(event, 'fs82', 226)" class="i">snd</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 227)" onmouseover="showTip(event, 'fs76', 227)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 228)" onmouseover="showTip(event, 'fs81', 228)" class="i">map</span> (<span class="k">fun</span> <span class="i">clp</span> <span class="k">-&gt;</span> <span class="i">clp</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 229)" onmouseover="showTip(event, 'fs83', 229)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 230)" onmouseover="showTip(event, 'fs84', 230)" class="i">map</span> <span onmouseout="hideTip(event, 'fs82', 231)" onmouseover="showTip(event, 'fs82', 231)" class="i">snd</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 232)" onmouseover="showTip(event, 'fs83', 232)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs85', 233)" onmouseover="showTip(event, 'fs85', 233)" class="i">toArray</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 234)" onmouseover="showTip(event, 'fs25', 234)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs86', 235)" onmouseover="showTip(event, 'fs86', 235)" class="i">unzip</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 236)" onmouseover="showTip(event, 'fs76', 236)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 237)" onmouseover="showTip(event, 'fs81', 237)" class="i">map</span> (<span class="k">fun</span> (<span class="i">ns</span>,<span class="i">points</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs25', 238)" onmouseover="showTip(event, 'fs25', 238)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs87', 239)" onmouseover="showTip(event, 'fs87', 239)" class="i">sum</span> <span class="i">ns</span>, <span onmouseout="hideTip(event, 'fs62', 240)" onmouseover="showTip(event, 'fs62', 240)" class="i">sumPoints</span> <span class="i">points</span> <span onmouseout="hideTip(event, 'fs11', 241)" onmouseover="showTip(event, 'fs11', 241)" class="i">dim</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 242)" onmouseover="showTip(event, 'fs76', 242)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 243)" onmouseover="showTip(event, 'fs81', 243)" class="i">map</span> (<span class="k">fun</span> (<span class="i">n</span>, <span class="i">sum</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs65', 244)" onmouseover="showTip(event, 'fs65', 244)" class="i">divPoint</span> <span class="i">sum</span> (<span onmouseout="hideTip(event, 'fs17', 245)" onmouseover="showTip(event, 'fs17', 245)" class="i">float</span> <span class="i">n</span>))
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 246)" onmouseover="showTip(event, 'fs76', 246)" class="i">ParStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 247)" onmouseover="showTip(event, 'fs88', 247)" class="i">toArray</span>

    <span class="c">// Stage 3: check convergence and decide whether to continue iteration</span>
    <span class="k">let</span> <span class="i">diff</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 248)" onmouseover="showTip(event, 'fs25', 248)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 249)" onmouseover="showTip(event, 'fs89', 249)" class="i">map2</span> <span onmouseout="hideTip(event, 'fs41', 250)" onmouseover="showTip(event, 'fs41', 250)" class="i">dist</span> <span class="i">newCentroids</span> <span onmouseout="hideTip(event, 'fs72', 251)" onmouseover="showTip(event, 'fs72', 251)" class="i">centroids</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 252)" onmouseover="showTip(event, 'fs25', 252)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 253)" onmouseover="showTip(event, 'fs90', 253)" class="i">max</span>

    <span class="k">do!</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Logf</span> <span class="s">&quot;KMeans: iteration [#%d], diff %A with centroids /n%A&quot;</span> <span onmouseout="hideTip(event, 'fs73', 254)" onmouseover="showTip(event, 'fs73', 254)" class="i">iteration</span> <span class="i">diff</span> <span onmouseout="hideTip(event, 'fs72', 255)" onmouseover="showTip(event, 'fs72', 255)" class="i">centroids</span>

    <span class="c">// emit an observation</span>
    <span onmouseout="hideTip(event, 'fs74', 256)" onmouseover="showTip(event, 'fs74', 256)" class="i">emit</span>(<span onmouseout="hideTip(event, 'fs91', 257)" onmouseover="showTip(event, 'fs91', 257)" class="i">DateTimeOffset</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 258)" onmouseover="showTip(event, 'fs92', 258)" class="i">UtcNow</span>,<span onmouseout="hideTip(event, 'fs73', 259)" onmouseover="showTip(event, 'fs73', 259)" class="i">iteration</span>,<span class="i">diff</span>,<span onmouseout="hideTip(event, 'fs72', 260)" onmouseover="showTip(event, 'fs72', 260)" class="i">centroids</span>)

    <span class="k">if</span> <span class="i">diff</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs71', 261)" onmouseover="showTip(event, 'fs71', 261)" class="i">epsilon</span> <span class="k">then</span>
        <span class="k">return</span> <span class="i">newCentroids</span>
    <span class="k">else</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs69', 262)" onmouseover="showTip(event, 'fs69', 262)" class="i">KMeansCloudIterate</span> (<span onmouseout="hideTip(event, 'fs70', 263)" onmouseover="showTip(event, 'fs70', 263)" class="i">partitionedPoints</span>, <span onmouseout="hideTip(event, 'fs71', 264)" onmouseover="showTip(event, 'fs71', 264)" class="i">epsilon</span>, <span class="i">newCentroids</span>, <span onmouseout="hideTip(event, 'fs73', 265)" onmouseover="showTip(event, 'fs73', 265)" class="i">iteration</span><span class="o">+</span><span class="n">1</span>, <span onmouseout="hideTip(event, 'fs74', 266)" onmouseover="showTip(event, 'fs74', 266)" class="i">emit</span>)
}

            
</code></pre></td>
</tr>
</table>

<p>The main cloud routine. Partitions the points according to the available workers, then iterates.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 267)" onmouseover="showTip(event, 'fs93', 267)" class="f">KMeansCloud</span>(<span onmouseout="hideTip(event, 'fs94', 268)" onmouseover="showTip(event, 'fs94', 268)" class="i">points</span>, <span onmouseout="hideTip(event, 'fs95', 269)" onmouseover="showTip(event, 'fs95', 269)" class="i">numCentroids</span>, <span onmouseout="hideTip(event, 'fs96', 270)" onmouseover="showTip(event, 'fs96', 270)" class="i">epsilon</span>, <span onmouseout="hideTip(event, 'fs97', 271)" onmouseover="showTip(event, 'fs97', 271)" class="i">emit</span>) <span class="o">=</span> <span class="i">cloud</span> {  

    <span class="k">let</span> <span class="i">initCentroids</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs94', 272)" onmouseover="showTip(event, 'fs94', 272)" class="i">points</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 273)" onmouseover="showTip(event, 'fs83', 273)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs98', 274)" onmouseover="showTip(event, 'fs98', 274)" class="i">concat</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 275)" onmouseover="showTip(event, 'fs83', 275)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs99', 276)" onmouseover="showTip(event, 'fs99', 276)" class="i">take</span> <span onmouseout="hideTip(event, 'fs95', 277)" onmouseover="showTip(event, 'fs95', 277)" class="i">numCentroids</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 278)" onmouseover="showTip(event, 'fs83', 278)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs85', 279)" onmouseover="showTip(event, 'fs85', 279)" class="i">toArray</span>

    <span class="k">let!</span> <span class="i">workers</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">GetAvailableWorkers</span>()
    <span class="k">do!</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Logf</span> <span class="s">&quot;KMeans: persisting partitioned point data to store.&quot;</span>
        
    <span class="c">// Divide the points</span>
    <span class="k">let!</span> <span class="i">partitionedPoints</span> <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs94', 280)" onmouseover="showTip(event, 'fs94', 280)" class="i">points</span> 
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 281)" onmouseover="showTip(event, 'fs83', 281)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs100', 282)" onmouseover="showTip(event, 'fs100', 282)" class="i">mapi</span> (<span class="k">fun</span> <span class="i">i</span> <span class="i">p</span> <span class="k">-&gt;</span> 
            <span class="i">local</span> { 
                <span class="c">// always schedule the same subset of points to the same worker</span>
                <span class="c">// for caching performance gains</span>
                <span class="k">let!</span> <span class="i">ca</span> <span class="o">=</span> <span class="i">CloudValue</span><span class="o">.</span><span class="i">NewArray</span>(<span class="i">p</span>, <span class="i">StorageLevel</span><span class="o">.</span><span class="i">MemoryAndDisk</span>) 
                <span class="k">return</span> <span class="i">ca</span>, <span class="i">workers</span><span class="o">.</span>[<span class="i">i</span> <span class="o">%</span> <span class="i">workers</span><span class="o">.</span><span class="i">Length</span>] }) 
        <span class="o">|&gt;</span> <span class="i">Local</span><span class="o">.</span><span class="i">Parallel</span>

    <span class="k">do!</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Logf</span> <span class="s">&quot;KMeans: persist completed, starting iteration.&quot;</span>

    <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs69', 283)" onmouseover="showTip(event, 'fs69', 283)" class="i">KMeansCloudIterate</span>(<span class="i">partitionedPoints</span>, <span onmouseout="hideTip(event, 'fs96', 284)" onmouseover="showTip(event, 'fs96', 284)" class="i">epsilon</span>, <span class="i">initCentroids</span>, <span class="n">1</span>, <span onmouseout="hideTip(event, 'fs97', 285)" onmouseover="showTip(event, 'fs97', 285)" class="i">emit</span>) 
}
</code></pre></td>
</tr>
</table>

<h2><a name="Running-a-test-flight-of-the-algorithm" class="anchor" href="#Running-a-test-flight-of-the-algorithm">Running a test flight of the algorithm</a></h2>

<p>You can now run a test flight of the algorithm with a drastically increased epsilon value to allow for
more rapid convergence:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs101', 286)" onmouseover="showTip(event, 'fs101', 286)" class="i">kmeansTask</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs93', 287)" onmouseover="showTip(event, 'fs93', 287)" class="f">KMeansCloud</span>(<span onmouseout="hideTip(event, 'fs31', 288)" onmouseover="showTip(event, 'fs31', 288)" class="i">randPoints</span>, <span onmouseout="hideTip(event, 'fs12', 289)" onmouseover="showTip(event, 'fs12', 289)" class="i">numCentroids</span>, <span onmouseout="hideTip(event, 'fs15', 290)" onmouseover="showTip(event, 'fs15', 290)" class="i">epsilon</span><span class="o">*</span><span class="n">10000.0</span>, <span onmouseout="hideTip(event, 'fs102', 291)" onmouseover="showTip(event, 'fs102', 291)" class="f">ignore</span>) 
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs8', 292)" onmouseover="showTip(event, 'fs8', 292)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs103', 293)" onmouseover="showTip(event, 'fs103', 293)" class="f">CreateProcess</span>
</code></pre></td>
</tr>
</table>

<p>Take a look at progress</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs8', 294)" onmouseover="showTip(event, 'fs8', 294)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 295)" onmouseover="showTip(event, 'fs104', 295)" class="f">ShowWorkers</span>()
<span onmouseout="hideTip(event, 'fs8', 296)" onmouseover="showTip(event, 'fs8', 296)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 297)" onmouseover="showTip(event, 'fs105', 297)" class="f">ShowProcesses</span>()
<span onmouseout="hideTip(event, 'fs101', 298)" onmouseover="showTip(event, 'fs101', 298)" class="i">kmeansTask</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs106', 299)" onmouseover="showTip(event, 'fs106', 299)" class="f">ShowLogs</span>()
<span onmouseout="hideTip(event, 'fs101', 300)" onmouseover="showTip(event, 'fs101', 300)" class="i">kmeansTask</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 301)" onmouseover="showTip(event, 'fs107', 301)" class="f">ShowInfo</span>()
</code></pre></td>
</tr>
</table>

<p>Get the result:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 302)" onmouseover="showTip(event, 'fs108', 302)" class="i">centroids</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs101', 303)" onmouseover="showTip(event, 'fs101', 303)" class="i">kmeansTask</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs109', 304)" onmouseover="showTip(event, 'fs109', 304)" class="i">Result</span>
</code></pre></td>
</tr>
</table>

<p>Now chart a selection of the original points and the overall result</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs38', 305)" onmouseover="showTip(event, 'fs38', 305)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs110', 306)" onmouseover="showTip(event, 'fs110', 306)" class="f">Combine</span>   
    [ <span onmouseout="hideTip(event, 'fs38', 307)" onmouseover="showTip(event, 'fs38', 307)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 308)" onmouseover="showTip(event, 'fs39', 308)" class="f">Point</span>(<span onmouseout="hideTip(event, 'fs35', 309)" onmouseover="showTip(event, 'fs35', 309)" class="i">selectionOfPoints</span>)
      <span onmouseout="hideTip(event, 'fs38', 310)" onmouseover="showTip(event, 'fs38', 310)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 311)" onmouseover="showTip(event, 'fs39', 311)" class="f">Point</span>(<span onmouseout="hideTip(event, 'fs108', 312)" onmouseover="showTip(event, 'fs108', 312)" class="i">centroids</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 313)" onmouseover="showTip(event, 'fs25', 313)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 314)" onmouseover="showTip(event, 'fs67', 314)" class="f">map</span> <span onmouseout="hideTip(event, 'fs33', 315)" onmouseover="showTip(event, 'fs33', 315)" class="f">point2d</span>, <span class="i">Color</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs111', 316)" onmouseover="showTip(event, 'fs111', 316)" class="i">Drawing</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs112', 317)" onmouseover="showTip(event, 'fs112', 317)" class="t">Color</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 318)" onmouseover="showTip(event, 'fs113', 318)" class="i">Red</span>) ]
</code></pre></td>
</tr>
</table>

<p>Giving <img src="../img/kmeans-results-1.png" alt="First results from KMeans" /></p>

<h2><a name="Observing-intermediate-states-of-the-algorithm" class="anchor" href="#Observing-intermediate-states-of-the-algorithm">Observing intermediate states of the algorithm</a></h2>

<p>Frequently when running iterative algorithms or long running processes you will need
to emit information for visualization and inspection of the progress of the algorithm.</p>

<p>To do this, you create a queue to observe the partial output results from the iterations.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs114', 319)" onmouseover="showTip(event, 'fs114', 319)" class="t">Observation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs91', 320)" onmouseover="showTip(event, 'fs91', 320)" class="t">DateTimeOffset</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs51', 321)" onmouseover="showTip(event, 'fs51', 321)" class="t">int</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs17', 322)" onmouseover="showTip(event, 'fs17', 322)" class="t">float</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs16', 323)" onmouseover="showTip(event, 'fs16', 323)" class="t">Point</span>[]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs115', 324)" onmouseover="showTip(event, 'fs115', 324)" class="i">watchQueue</span> <span class="o">=</span>  <span class="i">CloudQueue</span><span class="o">.</span><span class="i">New</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs114', 325)" onmouseover="showTip(event, 'fs114', 325)" class="i">Observation</span><span class="o">&gt;</span>()  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs8', 326)" onmouseover="showTip(event, 'fs8', 326)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs116', 327)" onmouseover="showTip(event, 'fs116', 327)" class="f">RunLocally</span>
</code></pre></td>
</tr>
</table>

<p>Next, you start the task, emitting observations to the queue:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs117', 328)" onmouseover="showTip(event, 'fs117', 328)" class="i">kmeansTask2</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs93', 329)" onmouseover="showTip(event, 'fs93', 329)" class="f">KMeansCloud</span>(<span onmouseout="hideTip(event, 'fs31', 330)" onmouseover="showTip(event, 'fs31', 330)" class="i">randPoints</span>, <span onmouseout="hideTip(event, 'fs12', 331)" onmouseover="showTip(event, 'fs12', 331)" class="i">numCentroids</span>, <span onmouseout="hideTip(event, 'fs15', 332)" onmouseover="showTip(event, 'fs15', 332)" class="i">epsilon</span>, <span onmouseout="hideTip(event, 'fs115', 333)" onmouseover="showTip(event, 'fs115', 333)" class="i">watchQueue</span><span class="o">.</span><span class="i">Enqueue</span>) 
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs8', 334)" onmouseover="showTip(event, 'fs8', 334)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs103', 335)" onmouseover="showTip(event, 'fs103', 335)" class="f">CreateProcess</span>
</code></pre></td>
</tr>
</table>

<p>Take a look at progress</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs117', 336)" onmouseover="showTip(event, 'fs117', 336)" class="i">kmeansTask2</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs106', 337)" onmouseover="showTip(event, 'fs106', 337)" class="f">ShowLogs</span>()
<span onmouseout="hideTip(event, 'fs8', 338)" onmouseover="showTip(event, 'fs8', 338)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 339)" onmouseover="showTip(event, 'fs104', 339)" class="f">ShowWorkers</span>()
<span onmouseout="hideTip(event, 'fs8', 340)" onmouseover="showTip(event, 'fs8', 340)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 341)" onmouseover="showTip(event, 'fs105', 341)" class="f">ShowProcesses</span>()
<span onmouseout="hideTip(event, 'fs117', 342)" onmouseover="showTip(event, 'fs117', 342)" class="i">kmeansTask2</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 343)" onmouseover="showTip(event, 'fs107', 343)" class="f">ShowInfo</span>()
</code></pre></td>
</tr>
</table>

<p>Next, you chart the intermediate results as they arrive as an incrementally updating chart:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs6', 344)" onmouseover="showTip(event, 'fs6', 344)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs118', 345)" onmouseover="showTip(event, 'fs118', 345)" class="i">Control</span>

<span onmouseout="hideTip(event, 'fs119', 346)" onmouseover="showTip(event, 'fs119', 346)" class="i">asyncSeq</span> { 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 347)" onmouseover="showTip(event, 'fs120', 347)" class="i">centroidsSoFar</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs121', 348)" onmouseover="showTip(event, 'fs121', 348)" class="t">ResizeArray</span>()
    <span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs115', 349)" onmouseover="showTip(event, 'fs115', 349)" class="i">watchQueue</span><span class="o">.</span><span class="i">TryDequeue</span>() <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs122', 350)" onmouseover="showTip(event, 'fs122', 350)" class="p">Some</span> (<span onmouseout="hideTip(event, 'fs123', 351)" onmouseover="showTip(event, 'fs123', 351)" class="i">time</span>, <span onmouseout="hideTip(event, 'fs124', 352)" onmouseover="showTip(event, 'fs124', 352)" class="i">iteration</span>, <span onmouseout="hideTip(event, 'fs125', 353)" onmouseover="showTip(event, 'fs125', 353)" class="i">diff</span>, <span onmouseout="hideTip(event, 'fs126', 354)" onmouseover="showTip(event, 'fs126', 354)" class="i">centroids</span>) <span class="k">-&gt;</span> 
                <span onmouseout="hideTip(event, 'fs120', 355)" onmouseover="showTip(event, 'fs120', 355)" class="i">centroidsSoFar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 356)" onmouseover="showTip(event, 'fs127', 356)" class="f">Add</span> <span onmouseout="hideTip(event, 'fs126', 357)" onmouseover="showTip(event, 'fs126', 357)" class="i">centroids</span>
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 358)" onmouseover="showTip(event, 'fs128', 358)" class="i">d</span> <span class="o">=</span> [ <span class="k">for</span> <span onmouseout="hideTip(event, 'fs126', 359)" onmouseover="showTip(event, 'fs126', 359)" class="i">centroids</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs120', 360)" onmouseover="showTip(event, 'fs120', 360)" class="i">centroidsSoFar</span> <span class="k">do</span> <span class="k">for</span> <span onmouseout="hideTip(event, 'fs34', 361)" onmouseover="showTip(event, 'fs34', 361)" class="i">p</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs126', 362)" onmouseover="showTip(event, 'fs126', 362)" class="i">centroids</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs33', 363)" onmouseover="showTip(event, 'fs33', 363)" class="f">point2d</span> <span onmouseout="hideTip(event, 'fs34', 364)" onmouseover="showTip(event, 'fs34', 364)" class="i">p</span> ]
                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs128', 365)" onmouseover="showTip(event, 'fs128', 365)" class="i">d</span>
                <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs129', 366)" onmouseover="showTip(event, 'fs129', 366)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs130', 367)" onmouseover="showTip(event, 'fs130', 367)" class="f">Sleep</span> <span class="n">1000</span>
        | <span onmouseout="hideTip(event, 'fs131', 368)" onmouseover="showTip(event, 'fs131', 368)" class="p">None</span> <span class="k">-&gt;</span> <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs129', 369)" onmouseover="showTip(event, 'fs129', 369)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs130', 370)" onmouseover="showTip(event, 'fs130', 370)" class="f">Sleep</span> <span class="n">1000</span>
} <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs132', 371)" onmouseover="showTip(event, 'fs132', 371)" class="t">AsyncSeq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs133', 372)" onmouseover="showTip(event, 'fs133', 372)" class="f">toObservable</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs134', 373)" onmouseover="showTip(event, 'fs134', 373)" class="t">LiveChart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs135', 374)" onmouseover="showTip(event, 'fs135', 374)" class="f">Point</span> 
</code></pre></td>
</tr>
</table>

<p>This produces the following incrementally:</p>

<p><img src="../img/kmeans-results-2-incremental.png" alt="Incremental results from KMeans" /></p>

<p>Now wait for the overall result:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs136', 375)" onmouseover="showTip(event, 'fs136', 375)" class="i">centroids2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs117', 376)" onmouseover="showTip(event, 'fs117', 376)" class="i">kmeansTask2</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs109', 377)" onmouseover="showTip(event, 'fs109', 377)" class="i">Result</span>
</code></pre></td>
</tr>
</table>

<p>Now chart the original points, the centroids we computed on the first flight, and the final centroids.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs38', 378)" onmouseover="showTip(event, 'fs38', 378)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs110', 379)" onmouseover="showTip(event, 'fs110', 379)" class="f">Combine</span>   
    [ <span onmouseout="hideTip(event, 'fs38', 380)" onmouseover="showTip(event, 'fs38', 380)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 381)" onmouseover="showTip(event, 'fs39', 381)" class="f">Point</span>(<span onmouseout="hideTip(event, 'fs35', 382)" onmouseover="showTip(event, 'fs35', 382)" class="i">selectionOfPoints</span>)
      <span onmouseout="hideTip(event, 'fs38', 383)" onmouseover="showTip(event, 'fs38', 383)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 384)" onmouseover="showTip(event, 'fs39', 384)" class="f">Point</span>(<span onmouseout="hideTip(event, 'fs108', 385)" onmouseover="showTip(event, 'fs108', 385)" class="i">centroids</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 386)" onmouseover="showTip(event, 'fs25', 386)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 387)" onmouseover="showTip(event, 'fs67', 387)" class="f">map</span> <span onmouseout="hideTip(event, 'fs33', 388)" onmouseover="showTip(event, 'fs33', 388)" class="f">point2d</span>, <span class="i">Color</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs111', 389)" onmouseover="showTip(event, 'fs111', 389)" class="i">Drawing</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs112', 390)" onmouseover="showTip(event, 'fs112', 390)" class="t">Color</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs137', 391)" onmouseover="showTip(event, 'fs137', 391)" class="i">Orange</span>,<span class="i">MarkerSize</span><span class="o">=</span><span class="n">10</span>) 
      <span onmouseout="hideTip(event, 'fs38', 392)" onmouseover="showTip(event, 'fs38', 392)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 393)" onmouseover="showTip(event, 'fs39', 393)" class="f">Point</span>(<span onmouseout="hideTip(event, 'fs136', 394)" onmouseover="showTip(event, 'fs136', 394)" class="i">centroids2</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 395)" onmouseover="showTip(event, 'fs25', 395)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 396)" onmouseover="showTip(event, 'fs67', 396)" class="f">map</span> <span onmouseout="hideTip(event, 'fs33', 397)" onmouseover="showTip(event, 'fs33', 397)" class="f">point2d</span>, <span class="i">Color</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs111', 398)" onmouseover="showTip(event, 'fs111', 398)" class="i">Drawing</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs112', 399)" onmouseover="showTip(event, 'fs112', 399)" class="t">Color</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 400)" onmouseover="showTip(event, 'fs113', 400)" class="i">Red</span>,<span class="i">MarkerSize</span><span class="o">=</span><span class="n">5</span>) ]
</code></pre></td>
</tr>
</table>

<p>Giving</p>

<p><img src="../img/kmeans-results-2.png" alt="The centroids found by the clustering" /></p>

<p>In this example, you've learned how to run an iterative algorithm on an MBrace cluster,
including how to emit and observe intermediate states from the iterations.
Continue with further samples to learn more about the MBrace programming model.</p>

<blockquote>
  <p>Note, you can use the above techniques from both scripts and compiled projects. To see the components referenced 
by this script, see <a href="../ThespianCluster.html">ThespianCluster.fsx</a> or <a href="../AzureCluster.html">AzureCluster.fsx</a>.</p>
</blockquote>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace Nessos</div>
<div class="tip" id="fs3">namespace Nessos.Streams</div>
<div class="tip" id="fs4">namespace MBrace</div>
<div class="tip" id="fs5">namespace MBrace.Core</div>
<div class="tip" id="fs6">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs7">namespace FSharp.Charting</div>
<div class="tip" id="fs8">val cluster : MBrace.Thespian.ThespianCluster<br /><br />Full name: 200-kmeans-clustering-example.cluster</div>
<div class="tip" id="fs9">module Config</div>
<div class="tip" id="fs10">val GetCluster : unit -&gt; MBrace.Thespian.ThespianCluster<br /><br />Full name: Config.GetCluster<br /><em><br /><br />&#160;Gets or creates a new Thespian cluster session.</em></div>
<div class="tip" id="fs11">val dim : int<br /><br />Full name: 200-kmeans-clustering-example.dim</div>
<div class="tip" id="fs12">val numCentroids : int<br /><br />Full name: 200-kmeans-clustering-example.numCentroids</div>
<div class="tip" id="fs13">val partitions : int<br /><br />Full name: 200-kmeans-clustering-example.partitions</div>
<div class="tip" id="fs14">val pointsPerPartition : int<br /><br />Full name: 200-kmeans-clustering-example.pointsPerPartition</div>
<div class="tip" id="fs15">val epsilon : float<br /><br />Full name: 200-kmeans-clustering-example.epsilon</div>
<div class="tip" id="fs16">type Point = float []<br /><br />Full name: 200-kmeans-clustering-example.Point<br /><em><br /><br />&#160;Represents a multi-dimensional point.</em></div>
<div class="tip" id="fs17">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs18">val generatePoints : dim:int -&gt; numPoints:int -&gt; seed:int -&gt; Point []<br /><br />Full name: 200-kmeans-clustering-example.generatePoints<br /><em><br /><br />&#160;Generates a set of points via a random walk from the origin, using provided seed.</em></div>
<div class="tip" id="fs19">val dim : int</div>
<div class="tip" id="fs20">val numPoints : int</div>
<div class="tip" id="fs21">val seed : int</div>
<div class="tip" id="fs22">val rand : Random</div>
<div class="tip" id="fs23">Multiple items<br />type Random =<br />&#160;&#160;new : unit -&gt; Random + 1 overload<br />&#160;&#160;member Next : unit -&gt; int + 2 overloads<br />&#160;&#160;member NextBytes : buffer:byte[] -&gt; unit<br />&#160;&#160;member NextDouble : unit -&gt; float<br /><br />Full name: System.Random<br /><br />--------------------<br />Random() : unit<br />Random(Seed: int) : unit</div>
<div class="tip" id="fs24">val prev : float []</div>
<div class="tip" id="fs25">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs26">val zeroCreate : count:int -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.zeroCreate</div>
<div class="tip" id="fs27">val nextPoint : (unit -&gt; float [])</div>
<div class="tip" id="fs28">val arr : float []</div>
<div class="tip" id="fs29">val i : int</div>
<div class="tip" id="fs30">Random.NextDouble() : float</div>
<div class="tip" id="fs31">val randPoints : Point [] []<br /><br />Full name: 200-kmeans-clustering-example.randPoints</div>
<div class="tip" id="fs32">val init : count:int -&gt; initializer:(int -&gt; &#39;T) -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.init</div>
<div class="tip" id="fs33">val point2d : p:Point -&gt; float * float<br /><br />Full name: 200-kmeans-clustering-example.point2d</div>
<div class="tip" id="fs34">val p : Point</div>
<div class="tip" id="fs35">val selectionOfPoints : (float * float) list<br /><br />Full name: 200-kmeans-clustering-example.selectionOfPoints</div>
<div class="tip" id="fs36">val points : Point []</div>
<div class="tip" id="fs37">property Array.Length: int</div>
<div class="tip" id="fs38">type Chart =<br />&#160;&#160;static member Area : data:seq&lt;#value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member Area : data:seq&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member Bar : data:seq&lt;#value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member Bar : data:seq&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member BoxPlotFromData : data:seq&lt;#key * #seq&lt;&#39;a2&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string * ?Percentile:int * ?ShowAverage:bool * ?ShowMedian:bool * ?ShowUnusualValues:bool * ?WhiskerPercentile:int -&gt; GenericChart (requires &#39;a2 :&gt; value)<br />&#160;&#160;static member BoxPlotFromStatistics : data:seq&lt;#key * #value * #value * #value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string * ?Percentile:int * ?ShowAverage:bool * ?ShowMedian:bool * ?ShowUnusualValues:bool * ?WhiskerPercentile:int -&gt; GenericChart<br />&#160;&#160;static member Bubble : data:seq&lt;#value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string * ?BubbleMaxSize:int * ?BubbleMinSize:int * ?BubbleScaleMax:float * ?BubbleScaleMin:float * ?UseSizeForLabel:bool -&gt; GenericChart<br />&#160;&#160;static member Bubble : data:seq&lt;#key * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string * ?BubbleMaxSize:int * ?BubbleMinSize:int * ?BubbleScaleMax:float * ?BubbleScaleMin:float * ?UseSizeForLabel:bool -&gt; GenericChart<br />&#160;&#160;static member Candlestick : data:seq&lt;#value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart<br />&#160;&#160;static member Candlestick : data:seq&lt;#key * #value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart<br />&#160;&#160;...<br /><br />Full name: FSharp.Charting.Chart</div>
<div class="tip" id="fs39">static member Chart.Point : data:seq&lt;#value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string * ?MarkerColor:Drawing.Color * ?MarkerSize:int -&gt; ChartTypes.GenericChart<br />static member Chart.Point : data:seq&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string * ?MarkerColor:Drawing.Color * ?MarkerSize:int -&gt; ChartTypes.GenericChart</div>
<div class="tip" id="fs40">Multiple items<br />type AutoOpenAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; AutoOpenAttribute<br />&#160;&#160;new : path:string -&gt; AutoOpenAttribute<br />&#160;&#160;member Path : string<br /><br />Full name: Microsoft.FSharp.Core.AutoOpenAttribute<br /><br />--------------------<br />new : unit -&gt; AutoOpenAttribute<br />new : path:string -&gt; AutoOpenAttribute</div>
<div class="tip" id="fs41">val dist : p1:Point -&gt; p2:Point -&gt; float<br /><br />Full name: 200-kmeans-clustering-example.KMeansHelpers.dist<br /><em><br /><br />&#160;Calculates the distance between two points.</em></div>
<div class="tip" id="fs42">val p1 : Point</div>
<div class="tip" id="fs43">val p2 : Point</div>
<div class="tip" id="fs44">val fold2 : folder:(&#39;State -&gt; &#39;T1 -&gt; &#39;T2 -&gt; &#39;State) -&gt; state:&#39;State -&gt; array1:&#39;T1 [] -&gt; array2:&#39;T2 [] -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.Array.fold2</div>
<div class="tip" id="fs45">val acc : float</div>
<div class="tip" id="fs46">val e1 : float</div>
<div class="tip" id="fs47">val e2 : float</div>
<div class="tip" id="fs48">val pown : x:&#39;T -&gt; n:int -&gt; &#39;T (requires member get_One and member ( * ) and member ( / ))<br /><br />Full name: Microsoft.FSharp.Core.Operators.pown</div>
<div class="tip" id="fs49">val findCentroid : p:Point -&gt; centroids:Point [] -&gt; int<br /><br />Full name: 200-kmeans-clustering-example.KMeansHelpers.findCentroid<br /><em><br /><br />&#160;Assigns a point to the correct centroid, and returns the index of that centroid.</em></div>
<div class="tip" id="fs50">val centroids : Point []</div>
<div class="tip" id="fs51">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs52">val mutable mini : int</div>
<div class="tip" id="fs53">val mutable min : float</div>
<div class="tip" id="fs54">type Double =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;&#160;&#160;member Equals : obj:obj -&gt; bool + 1 overload<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member GetTypeCode : unit -&gt; TypeCode<br />&#160;&#160;&#160;&#160;member ToString : unit -&gt; string + 3 overloads<br />&#160;&#160;&#160;&#160;static val MinValue : float<br />&#160;&#160;&#160;&#160;static val MaxValue : float<br />&#160;&#160;&#160;&#160;static val Epsilon : float<br />&#160;&#160;&#160;&#160;static val NegativeInfinity : float<br />&#160;&#160;&#160;&#160;static val PositiveInfinity : float<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.Double</div>
<div class="tip" id="fs55">field float.PositiveInfinity = Infinity</div>
<div class="tip" id="fs56">val dist : float</div>
<div class="tip" id="fs57">val kmeansLocal : points:Point [] -&gt; centroids:Point [] -&gt; (int * (int * Point)) []<br /><br />Full name: 200-kmeans-clustering-example.KMeansHelpers.kmeansLocal<br /><em><br /><br />&#160;Given a set of points, calculates the number of points assigned to each centroid.</em></div>
<div class="tip" id="fs58">val lens : int []</div>
<div class="tip" id="fs59">val sums : float [] []</div>
<div class="tip" id="fs60">val point : Point</div>
<div class="tip" id="fs61">val cent : int</div>
<div class="tip" id="fs62">val sumPoints : pointArr:Point [] -&gt; dim:int -&gt; Point<br /><br />Full name: 200-kmeans-clustering-example.KMeansHelpers.sumPoints<br /><em><br /><br />&#160;Sums a collection of points</em></div>
<div class="tip" id="fs63">val pointArr : Point []</div>
<div class="tip" id="fs64">val sum : float []</div>
<div class="tip" id="fs65">val divPoint : point:Point -&gt; x:float -&gt; Point<br /><br />Full name: 200-kmeans-clustering-example.KMeansHelpers.divPoint<br /><em><br /><br />&#160;Scalar division of a point</em></div>
<div class="tip" id="fs66">val x : float</div>
<div class="tip" id="fs67">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map</div>
<div class="tip" id="fs68">val p : float</div>
<div class="tip" id="fs69">val KMeansCloudIterate : partitionedPoints:&#39;a * epsilon:&#39;b * centroids:&#39;c * iteration:&#39;d * emit:&#39;e -&gt; &#39;f<br /><br />Full name: 200-kmeans-clustering-example.KMeansCloudIterate</div>
<div class="tip" id="fs70">val partitionedPoints : &#39;a</div>
<div class="tip" id="fs71">val epsilon : &#39;b</div>
<div class="tip" id="fs72">val centroids : &#39;c</div>
<div class="tip" id="fs73">val iteration : &#39;d</div>
<div class="tip" id="fs74">val emit : &#39;e</div>
<div class="tip" id="fs75">val concat : arrays:seq&lt;&#39;T []&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.concat</div>
<div class="tip" id="fs76">Multiple items<br />module ParStream<br /><br />from Nessos.Streams<br /><br />--------------------<br />type ParStream&lt;&#39;T&gt; =<br />&#160;&#160;private {Impl: ParStreamImpl&lt;&#39;T&gt;;}<br />&#160;&#160;member Apply : collector:ParCollector&lt;&#39;T,&#39;R&gt; -&gt; &#39;R<br />&#160;&#160;member private Stream : unit -&gt; Stream&lt;&#39;T&gt;<br />&#160;&#160;member DegreeOfParallelism : int<br />&#160;&#160;member private PreserveOrdering : bool<br />&#160;&#160;member private SourceType : SourceType<br /><br />Full name: Nessos.Streams.ParStream&lt;_&gt;</div>
<div class="tip" id="fs77">val ofArray : source:&#39;T [] -&gt; ParStream&lt;&#39;T&gt;<br /><br />Full name: Nessos.Streams.ParStream.ofArray</div>
<div class="tip" id="fs78">val groupBy : projection:(&#39;T -&gt; &#39;Key) -&gt; stream:ParStream&lt;&#39;T&gt; -&gt; ParStream&lt;&#39;Key * seq&lt;&#39;T&gt;&gt; (requires equality)<br /><br />Full name: Nessos.Streams.ParStream.groupBy</div>
<div class="tip" id="fs79">val fst : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T1<br /><br />Full name: Microsoft.FSharp.Core.Operators.fst</div>
<div class="tip" id="fs80">val sortBy : projection:(&#39;T -&gt; &#39;Key) -&gt; stream:ParStream&lt;&#39;T&gt; -&gt; ParStream&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Nessos.Streams.ParStream.sortBy</div>
<div class="tip" id="fs81">val map : f:(&#39;T -&gt; &#39;R) -&gt; stream:ParStream&lt;&#39;T&gt; -&gt; ParStream&lt;&#39;R&gt;<br /><br />Full name: Nessos.Streams.ParStream.map</div>
<div class="tip" id="fs82">val snd : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T2<br /><br />Full name: Microsoft.FSharp.Core.Operators.snd</div>
<div class="tip" id="fs83">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs84">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs85">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs86">val unzip : array:(&#39;T1 * &#39;T2) [] -&gt; &#39;T1 [] * &#39;T2 []<br /><br />Full name: Microsoft.FSharp.Collections.Array.unzip</div>
<div class="tip" id="fs87">val sum : array:&#39;T [] -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Array.sum</div>
<div class="tip" id="fs88">val toArray : stream:ParStream&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Nessos.Streams.ParStream.toArray</div>
<div class="tip" id="fs89">val map2 : mapping:(&#39;T1 -&gt; &#39;T2 -&gt; &#39;U) -&gt; array1:&#39;T1 [] -&gt; array2:&#39;T2 [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map2</div>
<div class="tip" id="fs90">val max : array:&#39;T [] -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Array.max</div>
<div class="tip" id="fs91">Multiple items<br />type DateTimeOffset =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;new : dateTime:DateTime -&gt; DateTimeOffset + 5 overloads<br />&#160;&#160;&#160;&#160;member Add : timeSpan:TimeSpan -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddDays : days:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddHours : hours:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddMilliseconds : milliseconds:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddMinutes : minutes:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddMonths : months:int -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddSeconds : seconds:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddTicks : ticks:int64 -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddYears : years:int -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.DateTimeOffset<br /><br />--------------------<br />DateTimeOffset()<br />DateTimeOffset(dateTime: DateTime) : unit<br />DateTimeOffset(ticks: int64, offset: TimeSpan) : unit<br />DateTimeOffset(dateTime: DateTime, offset: TimeSpan) : unit<br />DateTimeOffset(year: int, month: int, day: int, hour: int, minute: int, second: int, offset: TimeSpan) : unit<br />DateTimeOffset(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, offset: TimeSpan) : unit<br />DateTimeOffset(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, calendar: Globalization.Calendar, offset: TimeSpan) : unit</div>
<div class="tip" id="fs92">property DateTimeOffset.UtcNow: DateTimeOffset</div>
<div class="tip" id="fs93">val KMeansCloud : points:&#39;a * numCentroids:&#39;b * epsilon:&#39;c * emit:&#39;d -&gt; &#39;e<br /><br />Full name: 200-kmeans-clustering-example.KMeansCloud</div>
<div class="tip" id="fs94">val points : &#39;a</div>
<div class="tip" id="fs95">val numCentroids : &#39;b</div>
<div class="tip" id="fs96">val epsilon : &#39;c</div>
<div class="tip" id="fs97">val emit : &#39;d</div>
<div class="tip" id="fs98">val concat : sources:seq&lt;#seq&lt;&#39;T&gt;&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.concat</div>
<div class="tip" id="fs99">val take : count:int -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.take</div>
<div class="tip" id="fs100">val mapi : mapping:(int -&gt; &#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.mapi</div>
<div class="tip" id="fs101">val kmeansTask : MBrace.Runtime.CloudProcess&lt;Point []&gt;<br /><br />Full name: 200-kmeans-clustering-example.kmeansTask</div>
<div class="tip" id="fs102">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs103">member MBrace.Runtime.MBraceClient.CreateProcess : workflow:MBrace.Core.Cloud&lt;&#39;T&gt; * ?cancellationToken:MBrace.Core.ICloudCancellationToken * ?faultPolicy:MBrace.Core.FaultPolicy * ?target:MBrace.Core.IWorkerRef * ?additionalResources:MBrace.Core.Internals.ResourceRegistry * ?taskName:string -&gt; MBrace.Runtime.CloudProcess&lt;&#39;T&gt;</div>
<div class="tip" id="fs104">member MBrace.Runtime.MBraceClient.ShowWorkers : unit -&gt; unit</div>
<div class="tip" id="fs105">member MBrace.Runtime.MBraceClient.ShowProcesses : unit -&gt; unit</div>
<div class="tip" id="fs106">override MBrace.Runtime.CloudProcess.ShowLogs : ?filter:(MBrace.Runtime.CloudLogEntry -&gt; bool) -&gt; unit</div>
<div class="tip" id="fs107">member MBrace.Runtime.CloudProcess.ShowInfo : unit -&gt; unit</div>
<div class="tip" id="fs108">val centroids : Point []<br /><br />Full name: 200-kmeans-clustering-example.centroids</div>
<div class="tip" id="fs109">property MBrace.Runtime.CloudProcess.Result: Point []</div>
<div class="tip" id="fs110">static member Chart.Combine : charts:seq&lt;ChartTypes.GenericChart&gt; -&gt; ChartTypes.GenericChart</div>
<div class="tip" id="fs111">namespace System.Drawing</div>
<div class="tip" id="fs112">type Color =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;member A : byte<br />&#160;&#160;&#160;&#160;member B : byte<br />&#160;&#160;&#160;&#160;member Equals : obj:obj -&gt; bool<br />&#160;&#160;&#160;&#160;member G : byte<br />&#160;&#160;&#160;&#160;member GetBrightness : unit -&gt; float32<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member GetHue : unit -&gt; float32<br />&#160;&#160;&#160;&#160;member GetSaturation : unit -&gt; float32<br />&#160;&#160;&#160;&#160;member IsEmpty : bool<br />&#160;&#160;&#160;&#160;member IsKnownColor : bool<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.Drawing.Color</div>
<div class="tip" id="fs113">property Drawing.Color.Red: Drawing.Color</div>
<div class="tip" id="fs114">type Observation = DateTimeOffset * int * float * Point []<br /><br />Full name: 200-kmeans-clustering-example.Observation</div>
<div class="tip" id="fs115">val watchQueue : obj<br /><br />Full name: 200-kmeans-clustering-example.watchQueue</div>
<div class="tip" id="fs116">member MBrace.Runtime.MBraceClient.RunLocally : workflow:MBrace.Core.Cloud&lt;&#39;T&gt; * ?cancellationToken:MBrace.Core.ICloudCancellationToken * ?memoryEmulation:MBrace.Core.MemoryEmulation -&gt; &#39;T</div>
<div class="tip" id="fs117">val kmeansTask2 : MBrace.Runtime.CloudProcess&lt;Point []&gt;<br /><br />Full name: 200-kmeans-clustering-example.kmeansTask2</div>
<div class="tip" id="fs118">Multiple items<br />namespace FSharp.Control<br /><br />--------------------<br />namespace Microsoft.FSharp.Control</div>
<div class="tip" id="fs119">val asyncSeq : AsyncSeq.AsyncSeqBuilder<br /><br />Full name: FSharp.Control.AsyncSeqExtensions.asyncSeq</div>
<div class="tip" id="fs120">val centroidsSoFar : Collections.Generic.List&lt;seq&lt;Point&gt;&gt;</div>
<div class="tip" id="fs121">type ResizeArray&lt;&#39;T&gt; = Collections.Generic.List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.ResizeArray&lt;_&gt;</div>
<div class="tip" id="fs122">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs123">val time : obj</div>
<div class="tip" id="fs124">val iteration : obj</div>
<div class="tip" id="fs125">val diff : obj</div>
<div class="tip" id="fs126">val centroids : seq&lt;Point&gt;</div>
<div class="tip" id="fs127">Collections.Generic.List.Add(item: seq&lt;Point&gt;) : unit</div>
<div class="tip" id="fs128">val d : (float * float) list</div>
<div class="tip" id="fs129">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs130">static member Async.Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;</div>
<div class="tip" id="fs131">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs132">Multiple items<br />module AsyncSeq<br /><br />from FSharp.Control<br /><br />--------------------<br />type AsyncSeq&lt;&#39;T&gt; = IAsyncEnumerable&lt;&#39;T&gt;<br /><br />Full name: FSharp.Control.AsyncSeq&lt;_&gt;</div>
<div class="tip" id="fs133">val toObservable : source:AsyncSeq&lt;&#39;T&gt; -&gt; IObservable&lt;&#39;T&gt;<br /><br />Full name: FSharp.Control.AsyncSeq.toObservable</div>
<div class="tip" id="fs134">type LiveChart =<br />&#160;&#160;static member Area : data:IObservable&lt;#seq&lt;&#39;a1 * &#39;a2&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart (requires &#39;a1 :&gt; key and &#39;a2 :&gt; value)<br />&#160;&#160;static member Bar : data:IObservable&lt;#seq&lt;&#39;a1 * &#39;a2&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart (requires &#39;a1 :&gt; key and &#39;a2 :&gt; value)<br />&#160;&#160;static member Bubble : data:IObservable&lt;#seq&lt;&#39;a1 * &#39;a2 * &#39;a3&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string * ?BubbleMaxSize:int * ?BubbleMinSize:int * ?BubbleScaleMax:float * ?BubbleScaleMin:float * ?UseSizeForLabel:bool -&gt; GenericChart (requires &#39;a1 :&gt; key and &#39;a2 :&gt; value and &#39;a3 :&gt; value)<br />&#160;&#160;static member BubbleIncremental : data:IObservable&lt;#key * #value * #value&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string * ?BubbleMaxSize:int * ?BubbleMinSize:int * ?BubbleScaleMax:float * ?BubbleScaleMin:float * ?UseSizeForLabel:bool -&gt; GenericChart<br />&#160;&#160;static member Candlestick : data:IObservable&lt;#seq&lt;&#39;a1 * &#39;a2 * &#39;a3 * &#39;a4 * &#39;a5&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart (requires &#39;a1 :&gt; key and &#39;a2 :&gt; value and &#39;a3 :&gt; value and &#39;a4 :&gt; value and &#39;a5 :&gt; value)<br />&#160;&#160;static member Candlestick : data:IObservable&lt;seq&lt;#value * #value * #value * #value&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart<br />&#160;&#160;static member CandlestickIncremental : data:IObservable&lt;#key * #value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart<br />&#160;&#160;static member CandlestickIncremental : data:IObservable&lt;&#39;a0 * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart (requires &#39;a0 :&gt; key and &#39;a0 :&gt; value)<br />&#160;&#160;static member Column : data:IObservable&lt;#seq&lt;&#39;a1 * &#39;a2&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string * ?ColumnWidth:float -&gt; GenericChart (requires &#39;a1 :&gt; key and &#39;a2 :&gt; value)<br />&#160;&#160;static member ColumnIncremental : data:IObservable&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string * ?ColumnWidth:float -&gt; GenericChart<br />&#160;&#160;...<br /><br />Full name: FSharp.Charting.LiveChart</div>
<div class="tip" id="fs135">static member LiveChart.Point : data:IObservable&lt;#seq&lt;&#39;a1 * &#39;a2&gt;&gt; * ?Name:string * ?Title:string * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string * ?MarkerColor:Drawing.Color * ?MarkerSize:int -&gt; ChartTypes.GenericChart (requires &#39;a1 :&gt; key and &#39;a2 :&gt; value)</div>
<div class="tip" id="fs136">val centroids2 : Point []<br /><br />Full name: 200-kmeans-clustering-example.centroids2</div>
<div class="tip" id="fs137">property Drawing.Color.Orange: Drawing.Color</div>

        </div>
        <div class="span3">
          <a href="http://www.m-brace.net/index.html">
            <img src="http://www.m-brace.net/img/mbrace.png" alt="F# Project" style="width:150px;margin:10px" />
          </a>
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">MBrace.Core and MBrace.Azure</li>
            <li><a href="http://www.m-brace.net/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://www.nuget.org/packages/MBrace.Core">Get Library via NuGet</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core">Source Code on GitHub</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/LICENSE.md">License</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

            <li class="nav-header">Getting Started</li>
            <li><a href="http://www.m-brace.net/thespian-tutorial.html">Local cluster</a></li>
            <li><a href="http://www.m-brace.net/azure-tutorial.html">Azure cluster</a></li>
            <li class="divider"></li>
            <li><a target="_blank" href="http://www.m-brace.net/mbrace-plos.pdf">PLOS'13 Publication</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://www.m-brace.net/programming-model.html">Programming model</a></li>
            <li><a href="http://www.m-brace.net/reference/core/index.html">API Reference (MBrace.Core)</a></li>
            <li><a href="http://www.m-brace.net/reference/runtime/index.html">API Reference (MBrace.Runtime)</a></li>
            <li><a href="http://www.m-brace.net/reference/flow/index.html">API Reference (MBrace.Flow)</a></li>
            <li class="divider"></li>
            <li><a href="http://www.m-brace.net/reference/azure/index.html">Reference (Azure)</a></li>
            <li><a href="http://www.m-brace.net/reference/thespian/index.html">Reference (Local)</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/mbraceproject/MBrace.Core"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
